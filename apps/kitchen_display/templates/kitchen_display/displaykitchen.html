{% extends "base.html" %}

  {% block style %}
    <style>
      /* Simple, scalable, and smooth */
      .order-item {
        transition: opacity 120ms ease, filter 120ms ease;
      }
      .order-item.is-done {
        opacity: 0.35;
        text-decoration: line-through;
      }
    </style>
  {% endblock %}


    {% block header %}
    {% include "kitchen_display/snippets/header.html" %}
    {% endblock %}

    {% block content %}
    <!-- Board Area -->
    <div class="mx-auto w-full px-4 py-6">
      <div class="rounded-lg bg-gray-500/60 p-6 min-h-screen">
        <!-- Columns wrapper -->
        <div class="flex flex-wrap gap-6 overflow-x-auto pb-2">
          <!-- Card component -->
        {% for order in orders %}
          <section
            class="w-[330px] max-w-full shrink-0 bg-white rounded-md shadow-sm border border-gray-200"
          >
            <div class="px-4 pt-4 pb-3">
              <div class="flex items-start justify-between">
                <div>
                  <div class="text-sm font-semibold text-gray-800">
                    {% if order.table %}
                      T{{ order.table.number }}
                    {% else %}
                      {% if order.order_type == "takeaway" %}
                        Takeaway
                      {% elif order.order_type == "delivery" %}
                        Delivery
                      {% else %}
                        No table
                      {% endif %}
                    {% endif %}
                  </div>
                
                  <div class="mt-2 inline-flex items-center gap-2 text-sm text-gray-600">
                    <span
                      class="inline-flex items-center justify-center w-5 h-5 rounded-md bg-gray-100 border text-xs"
                      title="People"
                    >üë•</span>
                    <span class="text-xs font-semibold text-gray-700">
                      {{ order.guest_count }}
                    </span>
                  </div>
                </div>
              
                <div class="flex items-center gap-2">
                  <span
                    class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-gray-100 border text-sm"
                    title="Timer"
                  >‚è±</span>
                  <span
                    class="inline-flex items-center justify-center min-w-10 h-7 px-3 rounded-full bg-gray-100 border text-sm font-semibold text-gray-700"
                  >
                    0
                  </span>
                </div>
              </div>
            
              <div class="mt-2 text-sm text-gray-700">
                {{ order.get_order_type_display }}
              </div>
            </div>
          
            <div class="border-t"></div>
          
            <div class="px-4 py-4 space-y-3 text-sm">
              {% with has_items=False %}
                {% for item in order.items.all %}
                  {# filter station dulu #}
                  {% if item.menu_item.prep_station == station %}
                    {# filter status: kalau 'all', lepasin. Kalau tidak, cek status sama #}
                    {% if status_filter == 'all' or item.status == status_filter %}
                      {% if item.status == "completed" %}
                        <div
                          class="flex items-start gap-2 order-item cursor-pointer select-none is-done text-gray-300"
                          role="button"
                          tabindex="0"
                          aria-pressed="true"
                          data-item-id="{{ item.id }}"
                        >
                          <span>{{ item.quantity }}x</span>
                          <span>{{ item.menu_item.name }}</span>
                        </div>
                      {% else %}
                        <div
                          class="flex items-start gap-2 order-item cursor-pointer select-none"
                          role="button"
                          tabindex="0"
                          aria-pressed="false"
                          data-item-id="{{ item.id }}"
                        >
                          <span class="text-gray-600">{{ item.quantity }}x</span>
                          <span class="text-gray-900">{{ item.menu_item.name }}</span>
                        </div>
                      {% endif %}
                      
                      {% if item.notes %}
                        <div class="pl-7 text-gray-500">
                          - {{ item.notes }}
                        </div>
                      {% endif %}
                      
                      {% with has_items=True %}{% endwith %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
                      
                {% if not has_items %}
                  <div class="text-gray-500 text-xs">
                    No items for this status.
                  </div>
                {% endif %}
              {% endwith %}
            </div>
          </section>
        {% endfor %}
        {% comment %} End Section {% endcomment %}


        
          
        </div>
      </div>
    </div>
{% endblock %}
  
  {% block extra_js %}
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggleDone = (el) => {
        el.classList.toggle("is-done");
        // keep aria in sync
        const pressed = el.classList.contains("is-done");
        el.setAttribute("aria-pressed", String(pressed));

        // optional: if you want gray text when done (like your initial samples)
        if (pressed) el.classList.add("text-gray-300");
        else el.classList.remove("text-gray-300");
      };

      // Event delegation: one listener for all items
      document.body.addEventListener("click", (e) => {
        const item = e.target.closest(".order-item");
        if (!item) return;
        toggleDone(item);
      });

      // Keyboard support (Enter/Space)
      document.body.addEventListener("keydown", (e) => {
        if (e.key !== "Enter" && e.key !== " ") return;
        const item = e.target.closest(".order-item");
        if (!item) return;
        e.preventDefault();
        toggleDone(item);
      });
    });
  </script>
  {% endblock %}